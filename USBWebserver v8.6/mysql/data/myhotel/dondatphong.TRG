TYPE=TRIGGERS
triggers='CREATE DEFINER=`sManager`@`localhost` TRIGGER update_TongTienDonDatPhong\nBEFORE INSERT ON DONDATPHONG FOR EACH ROW\nBEGIN\n	DECLARE LoaiKH INT;\n    DECLARE SoNgayConLai INT;\n    DECLARE SoTien INT;\n    SET LoaiKH = (SELECT Loai FROM KHACHHANG WHERE KHACHHANG.MaKhachHang = NEW.DDP_MKH);\n    IF NEW.DDP_TG IS NULL THEN\n		IF LoaiKH = 2 THEN SET SoTien = NEW.TongTien * 9 / 10;\n		ELSEIF LoaiKH = 3 THEN SET SoTien = NEW.TongTien * 17 / 20;\n		ELSEIF LoaiKH = 4 THEN SET SoTien = NEW.TongTien * 4 / 5;\n		ELSE SET SoTien = NEW.TongTien;\n        END IF;\n	ELSE \n		SET SoTien = 0;\n        UPDATE HOADONGOIDICHVU\n        SET SoNgaySuDungConLai = SoNgaySuDungConLai - TIMESTAMPDIFF(DAY, NEW.NgayNhanPhong, NEW.NgayTraPhong)\n        WHERE HOADONGOIDICHVU.HDGDV_TG = NEW.DDP_TG AND HOADONGOIDICHVU.HDGDV_MKH = NEW.DDP_MKH;\n    END IF;\n	SET NEW.TongTien = SoTien;\nEND' 'CREATE DEFINER=`sManager`@`localhost` TRIGGER update_Diem_DDP\nAFTER INSERT ON DONDATPHONG FOR EACH ROW\nBEGIN\n    DECLARE DiemThem INT;\n    IF NEW.TinhTrang = 1 THEN\n		SET DiemThem = floor(NEW.TongTien/1000);\n		UPDATE KHACHHANG\n		SET Diem = Diem + DiemThem\n		WHERE MaKhachHang = NEW.DDP_MKH;\n	END IF;\nEND' 'CREATE DEFINER=`sManager`@`localhost` TRIGGER update_Diem_DDP_thanhtoan\nAFTER UPDATE ON DONDATPHONG FOR EACH ROW\nBEGIN\n    DECLARE DiemThem INT;\n    IF NEW.TinhTrang <> OLD. TinhTrang AND NEW.TinhTrang = 1 THEN\n		SET DiemThem = floor(NEW.TongTien/1000);\n		UPDATE KHACHHANG\n		SET Diem = Diem + DiemThem\n		WHERE MaKhachHang = NEW.DDP_MKH;\n	END IF;\nEND'
sql_modes=1073741824 1073741824 1073741824
definers='sManager@localhost' 'sManager@localhost' 'sManager@localhost'
client_cs_names='utf8' 'utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci' 'utf8_general_ci'
db_cl_names='latin1_swedish_ci' 'latin1_swedish_ci' 'latin1_swedish_ci'
